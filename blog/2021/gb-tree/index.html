<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Implementing Gradient Boosting Tree from scratch in Python | Richard Fan </title> <meta name="author" content="Richard Fan"> <meta name="description" content="This blog covers the theoretical framework behind Gradient Boosting Tree and its implementation in Python without using any libraries that directly implement it."> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://richard5678.github.io/blog/2021/gb-tree/"> <script src="/assets/js/theme.js?a5ca4084d3b81624bcfa01156dae2b8e"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>initTheme();</script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">Richard</span> Fan </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/">blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications </a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">projects </a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">repositories </a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">Implementing Gradient Boosting Tree from scratch in Python</h1> <p class="post-meta"> Created in December 10, 2021 </p> <p class="post-tags"> <a href="/blog/2021"> <i class="fa-solid fa-calendar fa-sm"></i> 2021 </a>   ·   <a href="/blog/tag/math"> <i class="fa-solid fa-hashtag fa-sm"></i> math</a>   <a href="/blog/tag/ml"> <i class="fa-solid fa-hashtag fa-sm"></i> ml</a>     ·   <a href="/blog/category/sample-posts"> <i class="fa-solid fa-tag fa-sm"></i> sample-posts</a>   </p> </header> <article class="post-content"> <div id="markdown-content"> <h1 id="introduction">Introduction</h1> <p>This blog covers the theoretical framework behind Gradient Boosting Tree and its implementation in Python without using any libraries that directly implement it.</p> <h2 id="motivation">Motivation</h2> <p>See the previous blog on <a href="/blog/2021/random-forest/">Random Forest</a>.</p> <h2 id="what-is-gradient-boosting-tree">What is Gradient Boosting Tree?</h2> <p>Similar to Random Forest, Gradient Boosting Tree (GBT) also consists of a collection of decision trees. However, unlike Random Forest, which trains those trees independently, GBT trains its trees sequentially. The next tree uses the residuals of the previous tree as its target variable instead of the original labels in classification tasks. This means that classification tasks for GBT are treated as regression problems since residuals are used as the target variable.</p> <p>When constructing the decision tree, the loss is calculated using residuals instead of labels. Below, we provide an example of how this works for classification tasks. For a visual demonstration of the algorithm, refer to <a href="https://www.youtube.com/watch?v=jxuNLH5dXCs&amp;t=730s" rel="external nofollow noopener" target="_blank">StatQuest</a>. Note that the video omits details on how the decision tree is constructed. In the example below, MSE loss is used.</p> <p>To find the optimal split point, each value of all features is considered. The loss of each split is calculated using the weighted MSE of the sub-groups. The predicted value of each sub-group is the mean of all residuals in that group.</p> <hr> <h2 id="implementation">Implementation</h2> <h3 id="the-gbt-function">The <code class="language-plaintext highlighter-rouge">gbt</code> Function</h3> <p>The core of the program is the <code class="language-plaintext highlighter-rouge">gbt</code> function:</p> <div class="d-flex justify-content-center"> <div class="col-sm-10 mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/gb_tree/gradientBoosting1-480.webp 480w,/assets/img/gb_tree/gradientBoosting1-800.webp 800w,/assets/img/gb_tree/gradientBoosting1-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/gb_tree/gradientBoosting1.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>This function calls the <code class="language-plaintext highlighter-rouge">build_tree</code> function a specified number of times (<code class="language-plaintext highlighter-rouge">treeLength</code>) and updates a progress bar accordingly. The trees returned from <code class="language-plaintext highlighter-rouge">build_tree</code> are stored in a list named <code class="language-plaintext highlighter-rouge">decision_trees</code>.</p> <hr> <h3 id="the-build_tree-function">The <code class="language-plaintext highlighter-rouge">build_tree</code> Function</h3> <p>The steps to build a tree are as follows:</p> <ol> <li> <strong>Find optimal split using MSE loss</strong> (lines 47–55).</li> <li> <strong>Initialize the node and fill in the decision boundary</strong> (lines 58–62).</li> <li> <strong>Construct left and right sub-trees</strong> under certain conditions (lines 66–69).</li> <li> <strong>Find the output of the leaf node</strong> and update predictions and residuals (lines 72–78).</li> </ol> <h4 id="key-differences-from-random-forest">Key Differences from Random Forest</h4> <ul> <li>The loss function for finding the optimal split uses MSE since GBT treats classification as a regression problem.</li> <li>Updates at leaf nodes include recalculating predictions and residuals.</li> </ul> <h4 id="loss-function">Loss Function</h4> <p>For GBT classification tasks, the Mean Squared Error (MSE) is used to find the optimal split:</p> <div class="d-flex justify-content-center"> <div class="col-sm-6 mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/gb_tree/gradientBoosting4-480.webp 480w,/assets/img/gb_tree/gradientBoosting4-800.webp 800w,/assets/img/gb_tree/gradientBoosting4-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/gb_tree/gradientBoosting4.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>An example:</p> <ul> <li>Residuals: 0.1, 0, -0.1</li> <li>Predicted value: 0</li> <li>MSE: \(\frac{(0.1 - 0)^2 + (-0.1 - 0)^2 + (0 - 0)^2}{3} = \frac{1}{150}\)</li> </ul> <hr> <h3 id="node-initialization-and-split">Node Initialization and Split</h3> <p>After finding the optimal split point, the node is initialized, and the split point is stored.</p> <h4 id="conditions-for-extending-sub-trees">Conditions for Extending Sub-Trees:</h4> <ul> <li>Both left and right sub-groups must have positive lengths.</li> <li>The weighted MSE of the split must be less than the MSE of the current node.</li> </ul> <h4 id="output-calculation-for-leaf-nodes">Output Calculation for Leaf Nodes</h4> <p>At leaf nodes, the output is computed as:</p> <div class="d-flex justify-content-center"> <div class="col-sm-6 mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/gb_tree/gradientBoosting5-480.webp 480w,/assets/img/gb_tree/gradientBoosting5-800.webp 800w,/assets/img/gb_tree/gradientBoosting5-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/gb_tree/gradientBoosting5.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>Predictions are updated using:</p> <div class="d-flex justify-content-center"> <div class="col-sm-6 mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/gb_tree/gradientBoosting6-480.webp 480w,/assets/img/gb_tree/gradientBoosting6-800.webp 800w,/assets/img/gb_tree/gradientBoosting6-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/gb_tree/gradientBoosting6.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>Residuals are updated using:</p> <div class="d-flex justify-content-center"> <div class="col-sm-6 mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/gb_tree/gradientBoosting7-480.webp 480w,/assets/img/gb_tree/gradientBoosting7-800.webp 800w,/assets/img/gb_tree/gradientBoosting7-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/gb_tree/gradientBoosting7.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <hr> <h3 id="making-predictions">Making Predictions</h3> <p>To make a prediction for (x), the <code class="language-plaintext highlighter-rouge">predict</code> function passes (x), all trained trees, initial predictions, and the learning rate. Each tree’s output is summed and passed to a sigmoid function to generate probabilities. Predictions are made using a threshold of 0.5.</p> <div class="d-flex justify-content-center"> <div class="col-sm-10 mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/gb_tree/gradientBoosting9-480.webp 480w,/assets/img/gb_tree/gradientBoosting9-800.webp 800w,/assets/img/gb_tree/gradientBoosting9-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/gb_tree/gradientBoosting9.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <hr> <h3 id="cross-validation">Cross-Validation</h3> <p>The <code class="language-plaintext highlighter-rouge">eval</code> function performs n-fold cross-validation on the dataset:</p> <div class="d-flex justify-content-center"> <div class="col-sm-10 mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/gb_tree/gradientBoosting10-480.webp 480w,/assets/img/gb_tree/gradientBoosting10-800.webp 800w,/assets/img/gb_tree/gradientBoosting10-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/gb_tree/gradientBoosting10.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <hr> <h2 id="results">Results</h2> <p>Using 10-fold cross-validation, an accuracy of 86% was achieved on the validation set:</p> <div class="d-flex justify-content-center"> <div class="col-sm-12 mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/gb_tree/gradientBoosting11-480.webp 480w,/assets/img/gb_tree/gradientBoosting11-800.webp 800w,/assets/img/gb_tree/gradientBoosting11-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/gb_tree/gradientBoosting11.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <hr> <h2 id="parameter-tuning">Parameter Tuning</h2> <p>GBT requires setting three hyperparameters:</p> <ol> <li><strong>Max Depth</strong></li> <li><strong>Number of Trees</strong></li> <li><strong>Learning Rate</strong></li> </ol> <p>To find the best combination, all possible values are tested using the sklearn library:</p> <div class="d-flex justify-content-center"> <div class="col-sm-11 mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/gb_tree/gradientBoosting12-480.webp 480w,/assets/img/gb_tree/gradientBoosting12-800.webp 800w,/assets/img/gb_tree/gradientBoosting12-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/gb_tree/gradientBoosting12.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>Results showed that 200 trees with a max depth of 5 and a learning rate of 0.1 achieved the best validation accuracy (85.94%), slightly lower than the custom implementation.</p> <div class="d-flex justify-content-center"> <div class="col-sm-12 mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/gb_tree/gradientBoosting13-480.webp 480w,/assets/img/gb_tree/gradientBoosting13-800.webp 800w,/assets/img/gb_tree/gradientBoosting13-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/gb_tree/gradientBoosting13.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <hr> <h2 id="implementation-1">Implementation</h2> <p>For full implementation details, see the <a href="https://github.com/Richard5678/Machine-Learning/blob/main/heart%20problem%20-%20gradient%20boosted%20tree.ipynb" rel="external nofollow noopener" target="_blank">GitHub repository</a>.</p> </div> </article> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2025 Richard Fan. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Photos from <a href="https://unsplash.com" target="_blank" rel="external nofollow noopener">Unsplash</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?b7816bd189846d29eded8745f9c4cf77"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.min.js"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>